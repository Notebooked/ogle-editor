<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>OGL Editor</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
</head>

<body>
    <div class="editor">
        <div class="top-bar">
            <div class="mode-list">
                <span onclick="setMode(0, '2D');" class="mode">2D</span>
                <span onclick="setMode(1, '3D');" class="mode">3D</span>
            </div>

            <div class="menu-dropdown">
                <img id="menu" src="editorimg/menu.png" alt="">
                <div id="menu-content">
                    <a class="menu-option" id="new-project-button">New Project</a>
                    <a class="menu-option" id="save-project-button">Save Project</a>
                    <a class="menu-option" id="open-project-folder-button">Open Project Folder</a>
                </div>
            </div>
        </div>
        <div class="middle-section">
            <div class="hierarchy" id="hierarchy" style="width: 300px">
                <div class="hierarchy-list editor-pane" id="hierarchy-list"></div>
                <div class="vert-dragbar" id="hierarchy-dragbar"></div>
            </div>
            <div id="stage-container">
                <div class="toolbar">
                    <img src="editorimg/select.png" class="tool-img tool-active" id="pointer-tool" alt="">
                    <img src="editorimg/translate.png" class="tool-img" id="translate-tool" alt="">
                    <img src="editorimg/rotate.png" class="tool-img" id="rotate-tool" alt="">
                </div>
                <iframe id="canvas-container" frameBorder="0" src="canvas-content.html" scrolling="no"></iframe>
            </div>
            <div class="properties" id="properties" style="width: 300px">
                <div class="vert-dragbar" id="properties-dragbar"></div>
                <div class="property-list editor-pane" id="property-list"></div>
            </div>
        </div>
        <div class="assets" id="assets" style="height: 400px">
            <div class="horiz-dragbar" id="assets-dragbar"></div>
            <div class="asset-list editor-pane" id="asset-list"></div>
        </div>
        <div id="dialog-container">
            <div id="new-project-dialog" class="dialog-box">
                <h1>New project!</h1>
                <span id="new-project-warning"></span>
                <div class="dialog-section">
                    <p>Project Folder</p>
                    <div>
                        <span id="new-project-span"></span>
                        <button onclick="chooseNewProjectFolder()">Choose</button>
                    </div>
                </div>
                <div class="dialog-section">
                    <p>Project Name</p>
                    <input type="text" id="new-project-name" name="new-project-name">
                </div>
                <div class="dialog-buttons">
                    <button onclick="cancelDialog()">Cancel</button>
                    <button onclick="confirmCreateProject()">Create</button>
                </div>
            </div>
        </div>
        <div id="context-menu"></div>
    </div>

    <script>
        const hierarchy = document.getElementById("hierarchy");
        const properties = document.getElementById("properties");
        const assets = document.getElementById("assets");

        const hierarchyDragbar = document.getElementById("hierarchy-dragbar");
        const propertiesDragbar = document.getElementById("properties-dragbar");
        const assetsDragbar = document.getElementById("assets-dragbar");

        const stageContainer = document.getElementById("stage-container");

        let hierarchyWidth = 300;
        let propertiesWidth = 300;
        let assetsHeight = 400;

        let hierarchyDragging = false;
        let propertiesDragging = false;
        let assetsDragging = false;

        hierarchyDragbar.onmousedown = () => {
            hierarchyDragging = true;

            stageContainer.style.zIndex = -100;
        };
        propertiesDragbar.onmousedown = () => {
            propertiesDragging = true;

            stageContainer.style.zIndex = -100;
        };
        assetsDragbar.onmousedown = () => {
            assetsDragging = true;

            stageContainer.style.zIndex = -100;
        };
        document.addEventListener("mousemove", (e) => {
            if (hierarchyDragging === true) {
                hierarchyWidth += e.movementX;
                hierarchy.style.width = hierarchyWidth + 'px';
            }
            else if (propertiesDragging === true) {
                propertiesWidth -= e.movementX;
                properties.style.width = propertiesWidth + 'px';
            }
            else if (assetsDragging === true) {
                assetsHeight -= e.movementY;
                assets.style.height = assetsHeight + 'px';
            }
        });

        document.addEventListener("mouseup", (e) => {
            hierarchyDragging = false;
            propertiesDragging = false;
            assetsDragging = false;

            stageContainer.style.zIndex = 100;
        });
    </script>

    <script>
        const menu = document.getElementById("menu");
        const menuContent = document.getElementById("menu-content");
        document.addEventListener("click", (e) => {
            if (event.target !== menu) {
                menuContent.classList.remove("show-menu-content");
            }
            else {
                menuContent.classList.toggle("show-menu-content");
            }
        })
    </script>

    <!-- Neutralino.js client. This file is gitignored, 
        because `neu update` typically downloads it.
        Avoid copy-pasting it. 
        -->
    <script src="js/neutralino.js"></script>
    <!-- Your app's source files -->
    <script src="js-oo/keyboardshortcuts.js"></script>

    <script>
        function iframe_clicked(event) {
        console.log("wow, no kiddin!");
        }
    </script>

    <script type="module">
        import { newProject, openProjectFolder } from "./js-oo/main.js";

        const newProjectButton = document.getElementById("new-project-button");
        const saveProjectButton = document.getElementById("save-project-button");
        const openProjectFolderButton = document.getElementById("open-project-folder-button");

        newProjectButton.onclick = newProject;
        openProjectFolderButton.onclick = openProjectFolder;

        import { setTool } from "./js-oo/stagemanager.js";

        const pointerTool = document.getElementById("pointer-tool");
        const translateTool = document.getElementById("translate-tool");
        const rotateTool = document.getElementById("rotate-tool");

        pointerTool.onclick = () => setTool(pointerTool, "pointer");
        translateTool.onclick = () => setTool(translateTool, "translate");
        rotateTool.onclick = () => setTool(rotateTool, "rotate");
    </script>
    <script src="js/contextmenu.js"></script>
</body>

</html>